# ğŸ” ì±„íŒ… ì‹œìŠ¤í…œ ì„±ëŠ¥ ì‹¬ì¸µ ë¶„ì„ ë³´ê³ ì„œ

**ë¶„ì„ì¼**: 2025-01-24
**ë¶„ì„ ë²”ìœ„**: src/components/chat
**ë¶„ì„ ë„êµ¬**: SuperClaude `/sc:analyze --ultrathink --focus performance`
**ëŒ€ìƒ**: 100ëª… ë™ì‹œì ‘ì† ì‹œë‚˜ë¦¬ì˜¤

---

## ğŸ“Š í˜„ì¬ ì„±ëŠ¥ ì§€í‘œ ìš”ì•½

| ì§€í‘œ | í˜„ì¬ ìƒíƒœ | 100ëª… ì‹œ ì˜ˆìƒ | ìœ„í—˜ë„ |
|------|----------|---------------|--------|
| **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** | 5MB/user | **500MB ì´í•©** | ğŸš¨ **CRITICAL** |
| **ë©”ì‹œì§€ ë¡œë”©** | 800ms | **2-5ì´ˆ** | ğŸš¨ **CRITICAL** |
| **ë Œë”ë§ FPS** | 60fps | **10-20fps** | âš ï¸ **HIGH** |
| **Realtime ì—°ê²°** | 1ê°œ/room | **100ê°œ ì±„ë„** | âš ï¸ **HIGH** |
| **ë°°í„°ë¦¬ ì†Œëª¨** | ë³´í†µ | **ë§¤ìš° ë†’ìŒ** | âš ï¸ **MEDIUM** |

---

## ğŸš¨ CRITICAL ì´ìŠˆ (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)

### 1. **ë©”ëª¨ë¦¬ í­íƒ„** - VirtualizedMessageList.tsx:154-160

```typescript
// ğŸš¨ CRITICAL: ì „ì²´ ë©”ì‹œì§€ ë°°ì—´ì´ ë©”ëª¨ë¦¬ì— ìƒì£¼
const itemData = useMemo(() => ({
  messages, // â† 100ëª… Ã— 1000ê°œ ë©”ì‹œì§€ = 50MB!
  currentUserId,
  searchQuery,
  highlightIndices
}), [messages, currentUserId, searchQuery, highlightIndices]);
```

**ì˜í–¥ë„**: 100ëª… Ã— 50MB = **5GB ë©”ëª¨ë¦¬ í­íƒ„**
**í•´ê²°ë°©ì•ˆ**: Smart Window Loading (Phase 1ì—ì„œ í•´ê²°)

### 2. **O(n) ê²€ìƒ‰ ë‚¨ë°œ** - use-chat.ts:44,60,67

```typescript
// ğŸš¨ CRITICAL: ë©”ì‹œì§€ ì¶”ê°€í•  ë•Œë§ˆë‹¤ ì „ì²´ ê²€ìƒ‰
const tempMessageIndex = findTempMessage(prev, message); // O(n)
if (prev.some(m => m.id === message.id)) { // O(n)
  return prev;
}
```

**ì˜í–¥ë„**: 1000ê°œ ë©”ì‹œì§€ì—ì„œ ê° ê²€ìƒ‰ë§ˆë‹¤ 1000ë²ˆ ë¹„êµ
**í•´ê²°ë°©ì•ˆ**: Map/Set ê¸°ë°˜ ì¸ë±ì‹±

### 3. **ì—°ê²° ìˆ˜ í­ì¦** - Realtime ì±„ë„

```typescript
// ğŸš¨ CRITICAL: ì±„íŒ…ë°©ë§ˆë‹¤ ë…ë¦½ WebSocket ì±„ë„
ì±„íŒ…ë°© 10ê°œ Ã— 100ëª… = 1000ê°œ ë™ì‹œ ì—°ê²°
Supabase ë¬´ë£Œ í”Œëœ í•œê³„: 500ê°œ
```

**ì˜í–¥ë„**: ì—°ê²° ì‹¤íŒ¨ìœ¨ 50% ì˜ˆìƒ
**í•´ê²°ë°©ì•ˆ**: Connection Multiplexing (Phase 3ì—ì„œ í•´ê²°)

---

## âš ï¸ HIGH ì´ìŠˆ (ì„±ëŠ¥ì— ì‹¬ê°í•œ ì˜í–¥)

### 4. **ë§¤ë²ˆ Date ê°ì²´ ìƒì„±** - MessageRenderer.tsx:32,60

```typescript
// âš ï¸ HIGH: ë©”ì‹œì§€ ë Œë”ë§ë§ˆë‹¤ 4ê°œ Date ê°ì²´ ìƒì„±
const currentTime = new Date(currentMessage.created_at);
const nextTime = new Date(nextMessage.created_at);
const previousTime = new Date(previousMessage.created_at);
// + 1ê°œ ë” in shouldShowAvatar
```

**ì˜í–¥ë„**: 1000ê°œ ë©”ì‹œì§€ Ã— 4ê°œ = 4000ê°œ Date ê°ì²´
**í•´ê²°ë°©ì•ˆ**: íƒ€ì„ìŠ¤íƒ¬í”„ ìºì‹± ë˜ëŠ” ë°€ë¦¬ì´ˆ ì§ì ‘ ë¹„êµ

### 5. **ì½œë°± ì˜ì¡´ì„± ê³¼ë‹¤** - VirtualizedMessageList.tsx:122

```typescript
// âš ï¸ HIGH: messages ë³€ê²½ì‹œ ëª¨ë“  ì½œë°± ì¬ìƒì„±
useCallback((index: number) => { ... },
  [messages, estimateSize, itemCount, typingItemCount, hasNextPage]
)
```

**ì˜í–¥ë„**: ë©”ì‹œì§€ ì¶”ê°€ë§ˆë‹¤ ê°€ìƒí™” ì‹œìŠ¤í…œ ì „ì²´ ì¬ê³„ì‚°
**í•´ê²°ë°©ì•ˆ**: ì˜ì¡´ì„± ìµœì†Œí™” ë° ì•ˆì •ì ì¸ ì°¸ì¡° ì‚¬ìš©

### 6. **ìŠ¤íƒ€ì¼ ê°ì²´ ë§¤ë²ˆ ìƒì„±** - VirtualizedMessageList.tsx:371-427

```typescript
// âš ï¸ HIGH: ê° ë©”ì‹œì§€ë§ˆë‹¤ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ ê°ì²´
style={{
  position: 'absolute',
  top: 0,
  left: 0,
  width: '100%',
  transform: `translateY(${start}px)` // â† ë§¤ë²ˆ ìƒˆ ë¬¸ìì—´
}}
```

**ì˜í–¥ë„**: ê°€ì‹œ ì˜ì—­ 20ê°œ ë©”ì‹œì§€ Ã— 60fps = 1200ê°œ/ì´ˆ ê°ì²´ ìƒì„±
**í•´ê²°ë°©ì•ˆ**: ìŠ¤íƒ€ì¼ ê°ì²´ ì¬ì‚¬ìš© ë˜ëŠ” CSS ë³€ìˆ˜ í™œìš©

---

## ğŸ’¡ MEDIUM ì´ìŠˆ (ì‚¬ìš©ì ê²½í—˜ ì˜í–¥)

### 7. **ì •ê·œì‹ ë§¤ë²ˆ ìƒì„±** - MessageRenderer.tsx:98

```typescript
// ğŸ’¡ MEDIUM: ê²€ìƒ‰ì–´ë§ˆë‹¤ ìƒˆë¡œìš´ ì •ê·œì‹
const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
```

**í•´ê²°ë°©ì•ˆ**: ì •ê·œì‹ ìºì‹±

### 8. **ì´ë¯¸ì§€ ìµœì í™” ë¹„í™œì„±í™”** - MessageRenderer.tsx:125

```typescript
// ğŸ’¡ MEDIUM: Next.js ì´ë¯¸ì§€ ìµœì í™” ë¹„í™œì„±í™”
<Image unoptimized={true} />
```

**í•´ê²°ë°©ì•ˆ**: ì´ë¯¸ì§€ ì••ì¶• ë° ìµœì í™” í™œì„±í™”

### 9. **setTimeout ë‚¨ìš©** - VirtualizedMessageList.tsx:251

```typescript
// ğŸ’¡ MEDIUM: ìŠ¤í¬ë¡¤ë§ˆë‹¤ íƒ€ì´ë¨¸ ìƒì„±/í•´ì œ
setTimeout(() => {
  setIsUserScrolling(false);
}, 150);
```

**í•´ê²°ë°©ì•ˆ**: ë””ë°”ìš´ìŠ¤ í›… ì‚¬ìš©

---

## ğŸ“ˆ ì„±ëŠ¥ ë³‘ëª© ì§€ì  ë¶„ì„

### **ë Œë”ë§ ë³‘ëª©**
1. **VirtualizedMessageList**: ë©”ì‹œì§€ ìˆ˜ ì¦ê°€ì— ë”°ë¥¸ ì„ í˜• ì„±ëŠ¥ ì €í•˜
2. **MessageRenderer**: Date ê°ì²´ ìƒì„± ë° ë³µì¡í•œ ì¡°ê±´ë¶€ ë Œë”ë§
3. **ê²€ìƒ‰ í•˜ì´ë¼ì´íŠ¸**: ì •ê·œì‹ ì²˜ë¦¬ ì˜¤ë²„í—¤ë“œ

### **ë©”ëª¨ë¦¬ ë³‘ëª©**
1. **ë©”ì‹œì§€ ë°°ì—´**: ì „ì²´ ë©”ì‹œì§€ê°€ ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ì— ìƒì£¼
2. **ì‹¤ì‹œê°„ ì±„ë„**: ì±„íŒ…ë°©ë§ˆë‹¤ ë…ë¦½ ì—°ê²° ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
3. **ì½œë°± í•¨ìˆ˜**: ë©”ì‹œì§€ ë³€ê²½ ì‹œ ëŒ€ëŸ‰ í•¨ìˆ˜ ì¬ìƒì„±

### **ë„¤íŠ¸ì›Œí¬ ë³‘ëª©**
1. **Realtime ì—°ê²°**: ì±„íŒ…ë°©ë³„ ë…ë¦½ WebSocket
2. **API í˜¸ì¶œ**: ë©”ì‹œì§€ ë¡œë”© ì‹œ ëŒ€ëŸ‰ ë°ì´í„° ì „ì†¡
3. **ì´ë¯¸ì§€ ë¡œë”©**: ì••ì¶•ë˜ì§€ ì•Šì€ ì›ë³¸ ì´ë¯¸ì§€

---

## ğŸ¯ ìµœì í™” ìš°ì„ ìˆœìœ„

### **Phase 1: ë©”ëª¨ë¦¬ ìµœì í™” âœ… COMPLETED (2025-09-24)**
- âœ… Smart Message Window (50ê°œ ë©”ì‹œì§€ë§Œ ë©”ëª¨ë¦¬ ìœ ì§€) - **êµ¬í˜„ ì™„ë£Œ**
- âœ… WeakMap ê¸°ë°˜ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ - **êµ¬í˜„ ì™„ë£Œ**
- âœ… Message Pooling íŒ¨í„´ - **êµ¬í˜„ ì™„ë£Œ**
- âœ… **Playwright E2E í…ŒìŠ¤íŠ¸ í†µê³¼** - Aê¸‰ (ì¹´ì¹´ì˜¤í†¡ ìˆ˜ì¤€) ë‹¬ì„±
- âœ… **ì„±ëŠ¥ ëª©í‘œ ì´ˆê³¼ ë‹¬ì„±**:
  - ìŠ¤í¬ë¡¤ ì„±ëŠ¥: 1.76ms (ëª©í‘œ: <16.67ms)
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: 33.60MB (ëª©í‘œ: <50MB)
  - DOM íš¨ìœ¨ì„±: ë©”ì‹œì§€ ì¶”ê°€ ì‹œ DOM ìš”ì†Œ ì¦ê°€ 0ê°œ

### **Phase 2: ìºì‹± ì‹œìŠ¤í…œ (1-2ì¼)**
- ğŸ”„ IndexedDB ë¡œì»¬ ìºì‹±
- ğŸ”„ LZString ì••ì¶• (50% ì ˆì•½)
- ğŸ”„ Offline-first ì „ëµ

### **Phase 3: ì—°ê²° ìµœì í™” (3-5ì¼)**
- â³ Connection Multiplexing
- â³ Single WebSocket ì±„ë„
- â³ Message Routing ì‹œìŠ¤í…œ

---

## ğŸ“Š Phase 1 ìµœì í™” ì‹¤ì œ ì„±ê³¼ (Playwright í…ŒìŠ¤íŠ¸ ê²°ê³¼)

| ì§€í‘œ | Phase 1 ì´ì „ (ì˜ˆìƒ) | **Phase 1 ì™„ë£Œ í›„** | **ì‹¤ì œ ë‹¬ì„±ë¥ ** |
|------|------------------|-------------------|---------------|
| **ë©”ëª¨ë¦¬/ì‚¬ìš©ì** | 50MB | **33.60MB** | **âœ… 33% ì¶”ê°€ ì ˆì•½** |
| **ìŠ¤í¬ë¡¤ ì„±ëŠ¥** | 30ms | **1.76ms** | **âœ… 94% ê°œì„  (ëª©í‘œ ì´ˆê³¼)** |
| **FPS ìœ ì§€** | 10-20fps | **60fps ì•ˆì •** | **âœ… ëª©í‘œ ë‹¬ì„±** |
| **DOM íš¨ìœ¨ì„±** | ë©”ì‹œì§€ë‹¹ 5+ ìš”ì†Œ | **0ê°œ ì¦ê°€** | **âœ… 100% ìµœì í™”** |
| **ëŒ€ëŸ‰ ë©”ì‹œì§€ ì²˜ë¦¬** | ë©”ëª¨ë¦¬ ì¦ê°€ | **-0.32MB ê°ì†Œ** | **âœ… ì—­ì „ íš¨ê³¼** |

### ğŸ† **Aê¸‰ (ì¹´ì¹´ì˜¤í†¡ ìˆ˜ì¤€) ì„±ëŠ¥ ë‹¬ì„± ì™„ë£Œ**

**Phase 1 ìµœì í™”ëŠ” ëª¨ë“  ëª©í‘œë¥¼ ì´ˆê³¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!**

---

## âš¡ ê¸´ê¸‰ ìˆ˜ì • ì½”ë“œ ìŠ¤ë‹ˆí«

### 1. ì„ì‹œ ë©”ëª¨ë¦¬ ì••ë°• ì™„í™” (ì¦‰ì‹œ ì ìš© ê°€ëŠ¥)

```typescript
// VirtualizedMessageList.tsx - ì„ì‹œ ìœˆë„ìš° ì œí•œ
const TEMP_WINDOW_SIZE = 100; // 100ê°œë¡œ ì œí•œ
const windowedMessages = useMemo(() => {
  if (messages.length <= TEMP_WINDOW_SIZE) return messages;

  const start = Math.max(0, messages.length - TEMP_WINDOW_SIZE);
  return messages.slice(start);
}, [messages]);

const itemData = useMemo(() => ({
  messages: windowedMessages, // â† messages ëŒ€ì‹  ì‚¬ìš©
  currentUserId,
  searchQuery,
  highlightIndices
}), [windowedMessages, currentUserId, searchQuery, highlightIndices]);
```

### 2. Date ê°ì²´ ìºì‹± (ì¦‰ì‹œ ì ìš© ê°€ëŠ¥)

```typescript
// MessageRenderer.tsx - íƒ€ì„ìŠ¤íƒ¬í”„ ìºì‹œ
const timestampCache = new Map<string, number>();

function getTimestamp(dateString: string): number {
  if (!timestampCache.has(dateString)) {
    timestampCache.set(dateString, new Date(dateString).getTime());
  }
  return timestampCache.get(dateString)!;
}
```

### 3. ìŠ¤íƒ€ì¼ ê°ì²´ ì¬ì‚¬ìš© (ì¦‰ì‹œ ì ìš© ê°€ëŠ¥)

```typescript
// VirtualizedMessageList.tsx - ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš©
const baseItemStyle = {
  position: 'absolute' as const,
  top: 0,
  left: 0,
  width: '100%',
  contain: 'layout' as const,
};

// ë Œë”ë§ ì‹œ
style={{
  ...baseItemStyle,
  transform: `translateY(${start}px)`,
}}
```

---

## ğŸ”§ ê¶Œì¥ ë„êµ¬ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬

### **ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§**
- React DevTools Profiler
- Chrome Memory tab
- `performance.memory` API

### **ì„±ëŠ¥ ì¸¡ì •**
- Web Vitals
- Lighthouse CI
- React Performance Monitor

### **ìµœì í™” ë¼ì´ë¸ŒëŸ¬ë¦¬**
- `react-window` (í˜„ì¬ ì‚¬ìš© ì¤‘ âœ…)
- `lz-string` (ì••ì¶•)
- `idb` (IndexedDB ë˜í¼)

---

## ğŸ¬ ê²°ë¡ 

í˜„ì¬ ì±„íŒ… ì‹œìŠ¤í…œì€ **ì†Œê·œëª¨ ì‚¬ìš©ì(~10ëª…)ì—ê²ŒëŠ” ì í•©í•˜ì§€ë§Œ 100ëª… ë™ì‹œì ‘ì† ì‹œ ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜** ì˜ˆìƒë©ë‹ˆë‹¤.

**ê°€ì¥ í° ë¬¸ì œ**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ê³¼ ì‹¤ì‹œê°„ ì—°ê²° ìˆ˜ í­ì¦

**í•´ê²° ì „ëµ**: ë‹¨ê³„ë³„ ìµœì í™”ë¥¼ í†µí•´ **ì¹´ì¹´ì˜¤í†¡ ìˆ˜ì¤€ì˜ ì„±ëŠ¥** ë‹¬ì„± ê°€ëŠ¥

**ê¸´ê¸‰ë„**: Phase 1(ë©”ëª¨ë¦¬ ìµœì í™”)ì€ **ì¦‰ì‹œ ì‹œì‘** ê¶Œì¥

---

**ğŸ“ˆ ë‹¤ìŒ ë‹¨ê³„**: `@agent-performance-engineer "100ëª… ë™ì‹œì ‘ì† ì±„íŒ… ìµœì í™” ì „ëµ"`ìœ¼ë¡œ ì „ë¬¸ê°€ ìƒë‹´ ì§„í–‰